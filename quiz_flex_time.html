<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>منصة تحدي القراءة الموحد</title>
    
    <style>
        body {
            font-family: Tahoma, Arial, sans-serif;
            background-color: #f7f9fc; 
            direction: rtl; 
            text-align: right;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .container {
            background: #ffffff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 900px;
            border: 1px solid #ddd;
        }

        h1 {
            color: #1a73e8; 
            font-size: 28px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .section-box {
            border: 2px solid #34a853; 
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 25px;
        }
        
        .section-box h2 {
            color: #34a853;
            margin-top: 0;
            font-size: 22px;
            border-bottom: 1px solid #dcdcdc;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }

        /* حقول الإدخال والقوائم المنسدلة */
        .form-group {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap; 
        }

        .form-group label {
            font-weight: bold;
            color: #555;
            min-width: 120px;
            margin-left: 10px;
        }

        .form-group input, .form-group select {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
            min-width: 150px;
            background-color: white; 
        }
        
        /* تنسيق الأزرار المشابهة للقوائم المنسدلة */
        .select-like-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        
        .select-like-group button {
            padding: 10px 15px;
            border: 1px solid #a0a0a0;
            border-radius: 5px;
            background-color: #f0f0f0;
            cursor: pointer;
            font-size: 16px;
            color: #333;
            transition: background-color 0.2s, border-color 0.2s;
        }

        .select-like-group button.selected {
            background-color: #fce3a7; 
            border-color: #ffc107;
            font-weight: bold;
            color: #333;
        }

        /* زر بدء التدريب */
        #start-button {
            display: block;
            width: 100%;
            padding: 15px;
            margin-top: 25px;
            border: none;
            border-radius: 8px;
            font-size: 24px;
            font-weight: bold;
            color: white;
            background-color: #1a73e8; 
            cursor: pointer;
            transition: background-color 0.3s;
        }

        #start-button:hover {
            background-color: #0d5dd1;
        }
        
        /* شاشة التحدي الفعلية */
        #quiz-display {
            display: none;
            width: 100%;
            text-align: center;
        }
        
        #quiz-display h1 {
             color: #34a853; 
        }

        .word-box {
            background-color: #fff9e6; 
            border: 4px solid #ffc107; 
            padding: 70px 30px;
            min-height: 200px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        #current-item {
            font-weight: 900;
            color: #333333;
            margin: 0;
            line-height: 1.5;
            /* التعديل هنا: نستخدم فليكس للتوسيط */
            display: flex; 
            align-items: center;
            justify-content: center; /* لتوسيط الكلمة والرقم معًا */
            width: 100%; 
            font-size: 70px; 
            gap: 15px; /* مسافة بسيطة بين الكلمة والرقم */
        }
        
        /* تنسيق الرقم */
        .item-number {
            font-weight: 900;
            color: #333;
            font-size: 70px; 
            /* لا حاجة لـ direction: ltr هنا لأننا سنستخدم الأرقام العربية مباشرةً */
            margin: 0;
        }
        
        /* تنسيق الكلمة نفسها */
        .item-content {
            font-size: 70px;
            margin: 0;
            padding: 0;
        }
        
        /* مؤقت الشريط */
        #timer-bar {
            position: absolute;
            bottom: 0;
            right: 0; 
            width: 100%;
            height: 15px;
            background-color: #ffc107; 
            transform-origin: right; 
        }
        
        /* زر العودة */
        .back-btn {
            background-color: #f44336; 
            color: white; 
            padding: 10px 20px; 
            border: none;
            border-radius: 5px; 
            font-size: 16px; 
            margin-top: 20px;
            cursor: pointer;
        }
        
    </style>
</head>
<body>
    <div class="container">
        
        <div id="setup-screen">
            <h1>منصة تحدي القراءة الموحد</h1>
            
            <div class="section-box">
                <h2>التدريب المتقدم</h2>
                
                <div class="form-group">
                    <label for="trainee-name">اسم المتدرب:</label>
                    <input type="text" id="trainee-name" placeholder="اكتب اسم المتدرب">
                </div>
                
                <div class="form-group">
                    <label for="start-index">البدء من الرقم:</label>
                    <input type="number" id="start-index" value="1" min="1" max="500" style="width: 100px; text-align: center;">
                    <span id="max-index-tip" style="color: #888; margin-right: 15px;">(الحد الأقصى: 500)</span>
                </div>
                
                <div class="form-group" id="group-selection-container">
                    <label for="group-select">اختيار المجموعة:</label>
                    <select id="group-select">
                        <option value="all_words">جميع الكلمات (500 كلمة)</option>
                        <option value="group_1">المجموعة 1: الأفعال الماضية الأساسية (50 كلمة)</option>
                        <option value="group_2">المجموعة 2: الأسماء الأساسية (50 كلمة)</option>
                        <option value="group_3">المجموعة 3: المدود والحركات الطويلة (50 كلمة)</option>
                        <option value="group_4">المجموعة 4: التنوين والشدة واللامات (50 كلمة)</option>
                        <option value="group_5">المجموعة 5: الضمائر والأسماء الموصولة (50 كلمة)</option>
                        <option value="group_6">المجموعة 6: الأرقام والترتيب (50 كلمة)</option>
                        <option value="group_7">المجموعة 7: الصفات والألوان الأساسية (50 كلمة)</option>
                        <option value="group_8">المجموعة 8: ظروف الزمان والمكان (50 كلمة)</option>
                        <option value="group_9">المجموعة 9: أسماء الأقارب والمهن (50 كلمة)</option>
                        <option value="group_10">المجموعة 10: أدوات الاستفهام والتعابير الشائعة (50 كلمة)</option>
                    </select>
                </div>
                
                <div style="display: flex; justify-content: space-between; flex-wrap: wrap; gap: 20px; margin-top: 20px;">
                    
                    <div style="flex: 1; min-width: 150px;">
                        <label style="display: block; font-weight: bold; margin-bottom: 5px;">المستوى الأول:</label>
                        <div class="select-like-group" id="level-selection-group">
                            <button data-level="words" data-max="500" class="selected">الكلمات (500)</button>
                            <button data-level="sentences" data-max="100">الجمل (100)</button>
                        </div>
                    </div>

                    <div style="flex: 1; min-width: 150px;">
                        <label style="display: block; font-weight: bold; margin-bottom: 5px;">القسم:</label>
                        <div class="select-like-group">
                             <button style="background-color: #e6e6e6; cursor: default;">الإحصاء (برج جدول وسيط)</button>
                        </div>
                    </div>
                    
                    <div style="flex: 1; min-width: 180px;">
                        <label style="display: block; font-weight: bold; margin-bottom: 5px;">المدة الزمنية:</label>
                        <div class="select-like-group" id="duration-selection-group">
                            <button data-duration="1000">1 ثانية</button>
                            <button data-duration="2000">2 ثواني</button>
                            <button data-duration="3000">3 ثواني</button>
                            <button data-duration="5000" class="selected">5 ثواني</button>
                            <button data-duration="10000">10 ثواني</button>
                            <button data-duration="20000">20 ثانية</button>
                            <button data-duration="30000">30 ثانية</button>
                        </div>
                    </div>
                </div>

                <p style="margin-top: 30px; text-align: center; font-size: 14px; color: #777;">إعداد الأستاذ عبدالعزيز الحجيلي</p>

            </div>
            
            <button id="start-button" onclick="validateAndStartQuiz()">اضغط لبدء التدريب</button>

            <p id="error-message" style="color: red; text-align: center; margin-top: 15px; font-weight: bold; display: none;"></p>
        </div>

        <div id="quiz-display">
            <h1 id="quiz-title"></h1>
            
            <div id="item-display" class="word-box">
                <p id="current-item">جاري البدء...</p>
                <div id="timer-bar"></div>
            </div>
            
            <p style="font-size: 20px; color: #555;">ستتغير النصوص تلقائيًا كل <span id="time-display"></span> ثوانٍ.</p>
            
            <button class="back-btn" onclick="location.reload()">العودة لصفحة الإعدادات</button>
        </div>
    </div>
    
    <script>
        // **********************************************
        // ********** 1. قوائم البيانات (500 كلمة و 100 جملة) **********
        // **********************************************

        const WORDS_GROUPS = {
            group_1: ["أَكَلَ", "شَرِبَ", "جَلَسَ", "دَرَسَ", "كَتَبَ", "لَعِبَ", "رَكَعَ", "سَجَدَ", "نَزَلَ", "صَعَدَ",
                      "فَتَحَ", "خَرَجَ", "طَبَخَ", "نَظَرَ", "سَأَلَ", "سَمِعَ", "قَرَأَ", "رَسَمَ", "نَجَحَ", "فَشِلَ",
                      "عَرَفَ", "ذَهَبَ", "عَادَ", "زَرَعَ", "حَصَدَ", "شَاهَدَ", "قَطَفَ", "بَنَى", "هَدَمَ", "صَنَعَ",
                      "طَلَبَ", "رَفَعَ", "وَضَعَ", "رَكِبَ", "نَامَ", "صَامَ", "قَامَ", "صَارَ", "مَاتَ", "بَكَى",
                      "ضَحِكَ", "جَمَعَ", "لَمَسَ", "أَخَذَ", "أَعْطَى", "أَرْسَلَ", "اسْتَمَعَ", "اِبْتَسَمَ", "غَضِبَ", "هَرَبَ"],
            
            group_2: ["أَبٌ", "أُمٌّ", "أَخٌ", "أُخْتٌ", "وَلَدٌ", "بِنْتٌ", "طِفْلٌ", "رَجُلٌ", "اِمْرَأَةٌ", "بَيْتٌ",
                      "غُرْفَةٌ", "بَابٌ", "نَافِذَةٌ", "كُرْسِيٌّ", "طَاوِلَةٌ", "كِتَابٌ", "قَلَمٌ", "دَفْتَرٌ", "وَرَقَةٌ", "صَفٌّ",
                      "مَكْتَبٌ", "مَدْرَسَةٌ", "مُعَلِّمٌ", "طَالِبٌ", "طَبِيبٌ", "نَجْمٌ", "قَمَرٌ", "شَمْسٌ", "بَحْرٌ", "نَهْرٌ",
                      "جَبَلٌ", "سَهْلٌ", "رِيحٌ", "مَطَرٌ", "نَارٌ", "مَاءٌ", "تُرَابٌ", "صُورَةٌ", "لَوْحَةٌ", "لَوْنٌ",
                      "حَجَرٌ", "ثَوْبٌ", "طَعَامٌ", "فَاكِهَةٌ", "خُضَارٌ", "خُبْزٌ", "لَحْمٌ", "سَمَكٌ", "شَجَرَةٌ", "وَرْدَةٌ"],

            group_3: ["حِصَانٌ", "زَرَافَةٌ", "بُسْتَانٌ", "دُيُورٌ", "فُصُولٌ", "عُيُونٌ", "أَيَادِي", "أَمَانَةٌ", "طَالِبٌ", "رَسُولٌ",
                      "عَامِلٌ", "صَائِمٌ", "قَارِئٌ", "سَمِيعٌ", "بَصِيرٌ", "كَبِيرٌ", "صَغِيرٌ", "جَمِيلٌ", "مَرِيضٌ", "جَائِعٌ",
                      "عَطْشَانٌ", "مَنَامُ", "يَسِيرُ", "نُزُولُ", "شُرُوقُ", "غُرُوبُ", "جُلُوسُ", "طَائِرٌ", "فَائِزٌ", "مَشْرُوبٌ",
                      "مَدِينَةٌ", "قُرْيَةٌ", "مِيزَانٌ", "سَاعَاتٌ", "دَقَائِقٌ", "ثَوَانِي", "كَنِيسَةٌ", "مَسْجِدٌ", "مُؤْمِنٌ", "صَادِقٌ",
                      "مُحَمَّدٌ", "إِبْرَاهِيمُ", "يُوسُفُ", "مُوسَى", "عِيسَى", "هَارُونُ", "إِسْمَاعِيلُ", "دَاوُودُ", "سُلَيْمَانُ", "صَفِيرُ"],

            group_4: ["سَمَكَةٌ", "طَائِرَةٌ", "مُهَنْدِسٌ", "مُعَلِّمَةٌ", "مَكْتَبَةٌ", "قَلَمًا", "كِتَابًا", "وَرَقَةٍ", "قَصَصٍ", "كُتُبٌ",
                      "السَّمَاءُ", "الشَّمْسُ", "النَّهَارُ", "اللَّيْلُ", "الْقَمَرُ", "الْأَرْضُ", "الْبَحْرُ", "الْجَبَلُ", "النَّاسُ", "الْحَيَاةُ",
                      "التُّفَّاحُ", "الشَّجَرَةُ", "الزَّرْعُ", "الْبَابُ", "الْكِتَابُ", "الْمَاءُ", "السُّكَّرُ", "الصَّبَاحُ", "الْمَسَاءُ", "الرَّبِيعُ",
                      "الصَّيْفُ", "الخَرِيفُ", "الشِّتَاءُ", "التَّدْرِيسُ", "الصِّحَّةُ", "المَرَضُ", "الصَّوْتُ", "الرِّيحُ", "السَّلَامُ", "الطَّرِيقُ",
                      "الشُّرْطَةُ", "المُسْتَشْفَى", "النِّظَافَةُ", "التِّلْمِيذُ", "الْمَلْعَبُ", "الْمَلِكُ", "الْحَقُّ", "الْوَاجِبُ", "الْبِدَايَةُ", "النِّهَايَةُ"],
            
            group_5: ["أَنَا", "نَحْنُ", "أَنْتَ", "أَنْتِ", "أَنْتُمَا", "أَنْتُمْ", "أَنْتُنَّ", "هُوَ", "هِيَ", "هُمَا", "هُمْ", "هُنَّ", 
                      "مِنْ", "إِلَى", "عَنْ", "عَلَى", "فِي", "البَاءِ", "الكَافِ", "اللَّامِ", "رُبَّ", "مُذْ", "مُنْذُ",
                      "هَذَا", "هَذِهِ", "هَؤُلَاءِ", "ذَلِكَ", "تِلْكَ", "أُولَئِكَ",
                      "الَّذِي", "الَّتِي", "الَّذَانِ", "الَّتَانِ", "الَّذِينَ", "اللَّاتِي", "مَنْ", "مَا",
                      "وَ", "فَ", "ثُمَّ", "أَوْ", "بَلْ", "لَكِنْ", "لا", "لَمْ", "لَنْ", "إِنْ"],

            group_6: ["وَاحِدٌ", "اِثْنَانِ", "ثَلَاثَةٌ", "أَرْبَعَةٌ", "خَمْسَةٌ", "سِتَّةٌ", "سَبْعَةٌ", "ثَمَانِيَةٌ", "تِسْعَةٌ", "عَشْرَةٌ",
                      "عِشْرُونَ", "ثَلَاثُونَ", "مِئَةٌ", "أَلْفٌ", "أَوَّلُ", "ثَانِي", "ثَالِثُ", "رَابِعُ", "خَامِسُ", "سَادِسُ",
                      "صِفْرٌ", "نِصْفٌ", "رُبْعٌ", "جُزْءٌ", "كُلٌّ", "بَعْضٌ", "كَمْ", "قَلِيلٌ", "كَثِيرٌ", "مُعْظَمُ",
                      "أَدْنَى", "أَقْصَى", "أَسْرَعُ", "أَبْطَأُ", "أَحْسَنُ", "أَجْمَلُ", "أَكْبَرُ", "أَصْغَرُ", "أَقْوَمُ", "أَعْلَى",
                      "أَطْوَلُ", "أَقْصَرُ", "أَغْلَى", "أَرْخَصُ", "أَبْيَضُ", "أَسْوَدُ", "أَحْمَرُ", "أَزْرَقُ", "أَخْضَرُ", "أَصْفَرُ"],

            group_7: ["سَعِيدٌ", "حَزِينٌ", "غَضْبَانُ", "مُتْعَبٌ", "نَشِيطٌ", "خَامِلٌ", "قَوِيٌّ", "ضَعِيفٌ", "مُبْتَسِمٌ", "بَاكٍ",
                      "جَدِيدٌ", "قَدِيمٌ", "صَادِقٌ", "كَاذِبٌ", "نَظِيفٌ", "وَسِخٌ", "حَارٌّ", "بَارِدٌ", "خَفِيفٌ", "ثَقِيلٌ",
                      "مُغْلَقٌ", "مَفْتُوحٌ", "مُمْتَلِئٌ", "فَارِغٌ", "هَادِئٌ", "صَاخِبٌ", "لَذِيذٌ", "مُرٌّ", "سَهْلٌ", "صَعْبٌ",
                      "كَرِيمٌ", "بَخِيلٌ", "ذَكِيٌّ", "غَبِيٌّ", "شُجَاعٌ", "جَبَانٌ", "حُلْوٌ", "مَالِحٌ", "طَوِيلٌ", "قَصِيرٌ",
                      "رَفِيعٌ", "عَرِيضٌ", "دَافِئٌ", "مُشْمِسٌ", "مُمْطِرٌ", "مُزْدَحِمٌ", "فَارِغٌ", "رَائِعٌ", "مُمِلٌّ", "عَمِيقٌ"],

            group_8: ["اليَوْمَ", "أَمْسِ", "غَدًا", "الآنَ", "قَبْلُ", "بَعْدُ", "سَابِقًا", "لَاحِقًا", "دَائِمًا", "أَبَدًا",
                      "أَحْيَانًا", "غَالِبًا", "صَبَاحًا", "مَسَاءً", "لَيْلًا", "نَهَارًا", "فَجْرًا", "ظُهْرًا", "عَصْرًا", "مَغْرِبًا",
                      "هُنَا", "هُنَاكَ", "أَمَامَ", "خَلْفَ", "فَوْقَ", "تَحْتَ", "يَمِينًا", "شِمَالًا", "دَاخِلَ", "خَارِجَ",
                      "قُرْبَ", "بُعْدَ", "جَانِبَ", "وَسْطَ", "حَوْلَ", "بَيْنَ", "أَيْنَمَا", "مَتَى", "كَيْفَ", "أَنَّى",
                      "حَيْثُ", "ثَمَّةَ", "مُبَكِّرًا", "مُتَأَخِّرًا", "مَعًا", "وَحْدِي", "فَجْأَةً", "سَرِيعًا", "بِهُدُوءٍ", "جَيِّدًا"],

            group_9: ["أُسْرَةٌ", "جَدٌّ", "جَدَّةٌ", "عَمٌّ", "عَمَّةٌ", "خَالٌ", "خَالَةٌ", "زَوْجٌ", "زَوْجَةٌ", "حَفِيدٌ",
                      "قَرِيبٌ", "ضَيْفٌ", "جَارٌ", "مُسَافِرٌ", "مُوَاطِنٌ", "صَدِيقٌ", "عَدُوٌّ", "مَلِكٌ", "رَئِيسٌ", "وَزِيرٌ",
                      "مُدِيرٌ", "مُهَنْدِسٌ", "فَلَّاحٌ", "نَجَّارٌ", "حَدَّادٌ", "خَبَّازٌ", "بَائِعٌ", "مُشْتَرٍ", "شُرْطِيٌّ", "جُنْدِيٌّ",
                      "قَاضٍ", "مُحَامٍ", "طَبَّاخٌ", "خَيَّاطٌ", "سَائِقٌ", "طَيَّارٌ", "بَحَّارٌ", "رَاعِي", "صَيَّادٌ", "مُمَرِّضٌ",
                      "سَاعِي", "عَامِلٌ", "رِيَاضِيٌّ", "مُغَنٍّ", "شَاعِرٌ", "فَنَّانٌ", "كَاتِبٌ", "رَسَّامٌ", "مُمَثِّلٌ", "قَصَّابٌ"],

            group_10: ["مَاذَا", "مَا", "مَنْ", "مَتَى", "أَيْنَ", "كَيْفَ", "كَمْ", "هَلْ", "لِمَاذَا", "أَلَا",
                       "نَعَمْ", "لَا", "حَسَنًا", "عَفْوًا", "شُكْرًا", "أَهْلًا", "مَرْحَبًا", "وَدَاعًا", "مَعَ", "بِدُونِ",
                       "إِلَّا", "فَقَطْ", "أيْضًا", "جِدًّا", "لِأَنَّ", "كَأَنَّ", "لَيْتَ", "لَعَلَّ", "عَسَى", "حَتَّى",
                       "قَدْ", "لَوْ", "إِذَا", "مَهْمَا", "حَيْثُمَا", "كُلَّمَا", "عِنْدَمَا", "بَيْنَمَا", "لِكَيْ", "كَيْ",
                       "لِئَلَّا", "وَإِنْ", "لَوْلَا", "أَمَّا", "إِمَّا", "أَيُّ", "مُعَيَّنٌ", "خَاصٌّ", "عَامٌّ", "مُخْتَلِفٌ"]
        };
        
        const ALL_WORDS = [].concat(...Object.values(WORDS_GROUPS));

        const SENTENCES = [
            "الطِفْلُ أَكَلَ الْوَجْبَةَ بِسُرْعَةٍ كَبِيرَةٍ.", "مُحَمَّدٌ شَرِبَ الْعَصِيرَ الطَّازَجَ كُلَّهُ.", "الْمُعَلِّمُ جَلَسَ أَمَامَ طُلَّابِهِ فِي هُدُوءٍ.", "أُخْتِي دَرَسَتْ بِجِدٍّ طَوَالَ اللَّيْلِ الْمَاضِي.", "الْكَاتِبُ كَتَبَ مَقَالَةً هَامَّةً لِلصَّحِيفَةِ.", "الْأَوْلَادُ لَعِبُوا بِالْكُرَةِ تَحْتَ الشَّمْسِ.", "الرَّجُلُ رَكَعَ وَسَجَدَ فِي صَلَاةِ الْفَجْرِ.", "نَزَلَ الْمَطَرُ خَفِيفًا عَلَى الْأَرْضِ الْجَافَّةِ.", "أَبِي صَعَدَ الْجَبَلَ الْعَالِيَ فِي سَاعَتَيْنِ.", "الطَّبِيبُ فَتَحَ الْبَابَ لِيَرَى الْمَرِيضَ.", 
            "الْقِطُّ خَرَجَ مِنَ الْبَيْتِ بَحْثًا عَنِ الطَّعَامِ.", "أُمِّي طَبَخَتْ كَعْكَةَ لَذِيذَةً بِمُنَاسَبَةِ الْعِيدِ.", "السَّائِحُ نَظَرَ إِلَى الْأَهْرَامَاتِ بِإِعْجَابٍ.", "الطَّالِبُ سَأَلَ الْمُدَرِّسَ عَنْ مَوْعِدِ الدَّرْسِ.", "نَحْنُ سَمِعْنَا صَوْتَ إِنْذَارِ الْحَرِيقِ قَوِيًّا.", "هِيَ قَرَأَتْ الْقِصَّةَ لِأَخِيهَا الصَّغِيرِ.", "الْفَنَّانُ رَسَمَ صُورَةَ الْغُرُوبِ عَلَى الشَّاطِئِ.", "الطَّالِبُ نَجَحَ بِتَفَوُّقٍ وَحَصَلَ عَلَى جَائِزَةٍ.", "لَا أَحَدَ فَشِلَ فِي مُحَاوَلَةِ التَّعَلُّمِ.", "الْعَالِمُ عَرَفَ سِرَّ الظَّاهِرَةِ الْغَرِيبَةِ.", 
            "هُمْ ذَهَبُوا إِلَى الْمَتْحَفِ لِمُشَاهَدَةِ الآثَارِ.", "الْمُسَافِرُونَ عَادُوا إِلَى وَطَنِهِمْ بَعْدَ غِيَابٍ.", "الْفَلَّاحُ زَرَعَ الْحَقْلَ كُلَّهُ فِي الصَّبَاحِ الْبَاكِرِ.", "الْعَامِلُ حَصَدَ الْقَمْحَ وَوَضَعَهُ فِي الْأَكْيَاسِ.", "نَحْنُ شَاهَدْنَا مَسْرَحِيَّةً جَمِيلَةً أَمْسِ.", "أَنْتَ قَطَفْتَ ثِمَارَ جُهُودِكَ فِي الْعَمَلِ.", "الْعُمَّالُ بَنَوْا جِسْرًا جَدِيدًا عَلَى النَّهْرِ.", "الزِّلْزَالُ هَدَمَ الْمَبَانِي الْقَدِيمَةَ بِقُوَّةٍ.", "صَنَعَ النَّجَّارُ كُرْسِيًّا خَشَبِيًّا مُتِينًا.", "أَنَا طَلَبْتُ قَهْوَةً سَاخِنَةً لِأَشْرَبَهَا.", 
            "الْجُمْهُورُ رَفَعَ الْأَعْلَامَ بَعْدَ الْفَوْزِ الْكَبِيرِ.", "الْمُوَظَّفُ وَضَعَ الْمِلَفَّاتِ فِي مَكَانِهَا الصَّحِيحِ.", "السَّائِحُ رَكِبَ الْجَمَلَ وَسَارَ فِي الصَّحْرَاءِ.", "الْبِنْتُ نَامَتْ مُبَكِّرًا لِتَسْتَيْقِظَ نَشِيطَةً.", "الْمُسْلِمُونَ صَامُوا رَمَضَانَ تَقَرُّبًا إِلَى اللهِ.", "الطَّائِرُ قَامَ بِالطَّيَرَانِ عَالِيًا فِي السَّمَاءِ.", "الْجَوُّ صَارَ أَكْثَرَ دِفْئًا مِنْ الْيَوْمِ الْمَاضِي.", "كُلُّ إِنْسَانٍ سَيَمُوتُ يَوْمًا مَا وَيُحَاسَبُ.", "الطِّفْلَةُ بَكَتْ بِصَوْتٍ عَالٍ لِأَنَّهَا جَائِعَةٌ.", "الْأُمُّ ضَحِكَتْ لِمُزَاحِ ابْنِهَا اللَّطِيفِ.", 
            "التُّجَّارُ جَمَعُوا الْبَضَائِعَ لِإِرْسَالِهَا.", "لَا تَلْمَسْ الْأَسْلَاكَ الْكَهْرَبَائِيَّةَ بِالْيَدِ.", "أَنَا أَخَذْتُ الْكُتُبَ وَوَضَعْتُهَا عَلَى الرَّفِّ.", "الْأَبُ أَعْطَى ابْنَهُ نَصِيحَةً غَالِيَةً.", "الشَّرِكَةُ أَرْسَلَتْ خَبَرًا سَعِيدًا لِلْعُمَّالِ.", "الطَّالِبُ اِسْتَمَعَ لِلْمُحَاضَرَةِ بِانْتِبَاهٍ كَامِلٍ.", "الْعَرِيسُ اِبْتَسَمَ فِي وَجْهِ عَرُوسِهِ الْجَمِيلَةِ.", "الْمُدِيرُ غَضِبَ بَعْدَ سَمَاعِهِ الْأَخْبَارَ السَّيِّئَةَ.", "الْغَزَالُ هَرَبَ مِنْ مَكَانِهِ عِنْدَمَا رَأَى الْأَسَدَ.", "هَذَا الْأَبُ يُحِبُّ أَوْلَادَهُ جِدًّا.",
            "أَخِي الْأَصْغَرُ يَلْعَبُ بِالْكُرَةِ فِي الْغُرْفَةِ.", "هَذَا الطِّفْلُ لَاعِبٌ مُمْتَازٌ فِي فَرِيقِهِ.", "الرَّجُلُ قَوِيٌّ وَيَحْمِلُ الْأَشْيَاءَ الثَّقِيلَةَ.", "تِلْكَ اَلْمَدْرَسَةُ جَدِيدَةٌ وَمُجَهَّزَةٌ بِشَكْلٍ جَيِّدٍ.", "الطَّبِيبُ يُعَالِجُ الْمَرْضَى فِي الْمُسْتَشْفَى.", "شَمْسُ الصَّبَاحِ سَاطِعَةٌ وَدَافِئَةٌ.", "أَنَا أَشْرَبُ الْمَاءَ عِنْدَمَا أَشْعُرُ بِالْعَطَشِ.", "هُنَاكَ حَجَرٌ كَبِيرٌ عَلَى جَانِبِ الطَّرِيقِ.", "هِيَ تَأْكُلُ الْفَاكِهَةَ فِي وَقْتِ الْعَصْرِ.", "أَنَا سَعِيدٌ جِدًّا بِالنَّجَاحِ فِي عَمَلِي.", 
            "الْوَلَدُ مُتْعَبٌ وَيَحْتَاجُ إِلَى النَّوْمِ الآنَ.", "هَذَا الْكِتَابُ جَدِيدٌ وَمُمْتِعٌ لِلْقِرَاءَةِ.", "لَا تَكُنْ كَاذِبًا وَعَلَيْكَ أَنْ تَكُونَ صَادِقًا.", "الْمَكَانُ نَظِيفٌ وَلَا يُوجَدُ فِيهِ غُبَارٌ.", "الْجَوُّ حَارٌّ جِدًّا فِي مَدِينَتِنَا هَذَا الْيَوْمَ.", "هَذَا الْبَابُ مُغْلَقٌ وَلَا أَسْتَطِيعُ فَتْحَهُ.", "الْوِعَاءُ مُمْتَلِئٌ بِالْحَلِيبِ السَّاخِنِ.", "الْمُعَلِّمُ هَادِئٌ وَيَشْرَحُ الدَّرْسَ بِصَبْرٍ.", "الطَّعَامُ لَذِيذٌ وَكُلُّ مَنْ أَكَلَهُ أَحَبَّهُ.", "السُّؤَالُ سَهْلٌ وَلَا يَحْتَاجُ إِلَى تَفْكِيرٍ طَوِيلٍ.", 
            "هُوَ ذَكِيٌّ جِدًّا وَيُجِيبُ عَلَى كُلِّ الْأَسْئِلَةِ.", "الطَّائِرُ صَغِيرٌ وَيَطِيرُ فَوْقَ الشَّجَرَةِ.", "أَنَا أُحِبُّ اللَّوْنَ الْأَزْرَقَ الْفَاتِحَ.", "اَلْقِطَارُ أَسْرَعُ مِنْ الْحَافِلَةِ فِي الطَّرِيقِ.", "أَنَا أَذْهَبُ إِلَى الْمَدْرَسَةِ دَائِمًا فِي الصَّبَاحِ.", "أَحْيَانًا أَلْعَبُ وَأَحْيَانًا أَدْرُسُ فِي الْبَيْتِ.", "اليَوْمَ سَوْفَ نَزُورُ جَدَّتَنَا فِي الْمَسَاءِ.", "غَدًا سَوْفَ نَبْدَأُ الْعَمَلَ عَلَى الْمَشْرُوعِ الْجَدِيدِ.", "نَحْنُ نَجْلِسُ هُنَا لِنَنْتَظِرَ قُدُومَ الْأَبِ.", "الكُتُبُ مَوْضُوعَةٌ فَوْقَ الْمَكْتَبِ الْخَشَبِيِّ.", 
            "الْكُرَةُ تَحْتَ الْكُرْسِيِّ وَلَا أَسْتَطِيعُ رُؤْيَتَهَا.", "الْأَوْلَادُ يَلْعَبُونَ خَلْفَ الْبَيْتِ الْكَبِيرِ.", "الطَّعَامُ دَاخِلَ الثَّلَّاجَةِ حَتَّى لَا يَفْسُدَ.", "الْمُسْتَشْفَى قَرِيبٌ مِنْ مَنْزِلِ عَمِّي.", "أَنَا وَأَخِي نَلْعَبُ مَعًا كُلَّ يَوْمٍ.", "جَدَّتِي تُحِبُّ الْوَرْدَةَ الْحَمْرَاءَ الْجَمِيلَةَ.", "الْجَارُ يُسَاعِدُ جَارَهُ فِي الْأَعْمَالِ الصَّعْبَةِ.", "الْمُدِيرُ يَقُودُ الْعَمَلَ فِي الشَّرِكَةِ بِكُلِّ جَدٍّ.", "نَحْنُ نُحِبُّ مُعَلِّمَنَا وَنَحْتَرِمُهُ كَثِيرًا.", "هَذَا الْمَلِكُ يَحْكُمُ الْبِلَادَ بِعَدْلٍ وَقُوَّةٍ.", 
            "هَلْ سَافَرْتَ إِلَى مِصْرَ مِنْ قَبْلُ؟", "كَمْ سَاعَةً سَنَقْضِيهَا فِي هَذَا الْمَكَانِ؟", "لِمَاذَا تَأَخَّرَ الطَّائِرُ عَنِ الْإِقْلَاعِ الْيَوْمَ؟", "نَعَمْ، سَوْفَ نَذْهَبُ مَعًا إِلَى الْحَدِيقَةِ.", "نَحْنُ نَقُومُ بِالْعَمَلِ بِهُدُوءٍ وَاِحْتِرَافِيَّةٍ.", "شُكْرًا لَكَ عَلَى الْمُسَاعَدَةِ الْكَبِيرَةِ.", "اَلْأَطْفَالُ يَجْرُونَ سَرِيعًا فِي الْمَلْعَبِ.", "أَنَا أُحِبُّ الْقِرَاءَةَ جِدًّا فِي وَقْتِ الْفَرَاغِ.", "الْمُدِيرُ قَدْ أَرْسَلَ رِسَالَةً إِلَى الْمُوَظَّفِينَ."
        ];
        // ********** نهاية قوائم البيانات **********

        // **********************************************
        // ********** 2. دالة تحويل الأرقام إلى عربية **********
        // **********************************************
        function convertToArabicNumbers(num) {
            const arabicNumbers = ['٠', '١', '٢', '٣', '٤', '٥', '٦', '٧', '٨', '٩'];
            return String(num).split('').map(digit => arabicNumbers[digit]).join('');
        }

        // **********************************************
        // ********** 3. متغيرات وعناصر التحكم **********
        // **********************************************

        let itemsArray;
        let currentItemIndex = 0;
        let intervalDuration = 5000; 
        let quizInterval;
        let selectedLevel = 'words'; 
        let maxItems = 500; 
        let selectedGroupKey = 'all_words'; 

        const setupScreen = document.getElementById('setup-screen');
        const quizDisplayDiv = document.getElementById('quiz-display');
        const currentItemElement = document.getElementById('current-item');
        const timerBar = document.getElementById('timer-bar');
        const quizTitle = document.getElementById('quiz-title');
        const timeDisplay = document.getElementById('time-display');
        const wordBox = document.querySelector('.word-box');
        const errorMessage = document.getElementById('error-message');
        const traineeNameInput = document.getElementById('trainee-name');
        const startIndexInput = document.getElementById('start-index');
        const maxIndexTip = document.getElementById('max-index-tip');
        const groupSelect = document.getElementById('group-select');
        const groupSelectionContainer = document.getElementById('group-selection-container');

        quizDisplayDiv.style.display = 'none'; 
        groupSelectionContainer.style.display = 'flex'; 

        // **********************************************
        // ********** 4. دوال التحكم والتشغيل **********
        // **********************************************

        // 1. وظيفة تحديث المؤقت البصري (شريط التقدم)
        function startTimerBar(seconds) {
            timerBar.style.transition = 'none';
            timerBar.style.width = '100%';
            
            requestAnimationFrame(() => {
                requestAnimationFrame(() => {
                    timerBar.style.transition = `width ${seconds}s linear`;
                    timerBar.style.width = '0%';
                });
            });
        }
        
        // 2. وظيفة عرض العنصر التالي
        function displayNextItem() {
            if (itemsArray.length === 0) {
                currentItemElement.innerHTML = "عفواً، القائمة فارغة.";
                clearInterval(quizInterval);
                return;
            }
            
            const itemNumber = currentItemIndex + 1;
            const arabicItemNumber = convertToArabicNumbers(itemNumber); // تحويل الرقم إلى عربي
            const itemContent = itemsArray[currentItemIndex];
            
            // التعديل الجديد: الترتيب هو (الكلمة الرقم) باللغة العربية
            currentItemElement.innerHTML = `
                <span class="item-content">${itemContent}</span>
                <span class="item-number">${arabicItemNumber}</span>
            `;
            
            startTimerBar(intervalDuration / 1000);
            
            currentItemIndex = (currentItemIndex + 1);
            if (currentItemIndex >= itemsArray.length) {
                currentItemIndex = 0; // العودة للبداية إذا انتهت القائمة
            }
        }

        // 3. وظيفة بدء التحدي الفعلي بعد التحقق
        function startQuiz() {
            setupScreen.style.display = 'none';
            quizDisplayDiv.style.display = 'block';

            if (quizInterval) {
                clearInterval(quizInterval);
            }

            if (selectedLevel === 'words') {
                selectedGroupKey = groupSelect.value;
                itemsArray = (selectedGroupKey === 'all_words') ? ALL_WORDS : WORDS_GROUPS[selectedGroupKey];
            } else { 
                itemsArray = SENTENCES;
            }

            const seconds = intervalDuration / 1000;
            const traineeName = traineeNameInput.value.trim();
            const startNum = parseInt(startIndexInput.value) || 1;
            
            let actualMax = itemsArray.length;
            currentItemIndex = (startNum > 0 && startNum <= actualMax) ? startNum - 1 : 0;
            
            const levelText = selectedLevel === 'words' ? (groupSelect.options[groupSelect.selectedIndex].text) : 'الجمل (100 جملة)';
            quizTitle.innerHTML = `تحدي **${levelText}** للمتدرب: **${traineeName}**`;
            timeDisplay.textContent = seconds;
            
            // ضبط حجم الخط ولون الشريط والخلفية والإطار
            // تم تحديد حجم الخط الكبير الآن على #current-item
            timerBar.style.backgroundColor = (selectedLevel === 'words') ? '#ffc107' : '#34a853';
            wordBox.style.borderColor = (selectedLevel === 'words') ? '#ffc107' : '#34a853';
            wordBox.style.backgroundColor = (selectedLevel === 'words') ? '#fff9e6' : '#e6ffe6';
            
            displayNextItem();
            quizInterval = setInterval(displayNextItem, intervalDuration);
        }

        // 4. وظيفة التحقق والبدء (مربوطة بزر البدء)
        window.validateAndStartQuiz = function() {
            errorMessage.style.display = 'none';
            
            if (traineeNameInput.value.trim() === "") {
                errorMessage.textContent = "الرجاء كتابة اسم المتدرب قبل البدء.";
                errorMessage.style.display = 'block';
                return;
            }

            const startNum = parseInt(startIndexInput.value);
            let actualMax = selectedLevel === 'words' ? (selectedGroupKey === 'all_words' ? ALL_WORDS.length : WORDS_GROUPS[selectedGroupKey].length) : SENTENCES.length;
            
            if (isNaN(startNum) || startNum < 1 || startNum > actualMax) {
                errorMessage.textContent = `رقم البدء غير صحيح. يجب أن يكون بين 1 و ${actualMax} ضمن هذه المجموعة.`;
                errorMessage.style.display = 'block';
                return;
            }

            startQuiz();
        }

        // 5. وظيفة التحكم باختيار المستوى والوقت
        document.addEventListener('DOMContentLoaded', () => {
            const levelButtons = document.querySelectorAll('#level-selection-group button');
            const durationButtons = document.querySelectorAll('#duration-selection-group button');

            levelButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    levelButtons.forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                    
                    selectedLevel = this.dataset.level;
                    maxItems = parseInt(this.dataset.max);
                    
                    if (selectedLevel === 'words') {
                        groupSelectionContainer.style.display = 'flex';
                        groupSelect.value = 'all_words'; 
                        maxIndexTip.textContent = `(الحد الأقصى: 500)`;
                        startIndexInput.max = 500;
                    } else { 
                        groupSelectionContainer.style.display = 'none';
                        maxIndexTip.textContent = `(الحد الأقصى: 100)`;
                        startIndexInput.max = 100;
                    }
                    
                    startIndexInput.value = 1; 
                });
            });
            
            groupSelect.addEventListener('change', function() {
                selectedGroupKey = this.value;
                const newMax = (selectedGroupKey === 'all_words') ? ALL_WORDS.length : WORDS_GROUPS[selectedGroupKey].length;
                
                maxIndexTip.textContent = `(الحد الأقصى: ${newMax})`;
                startIndexInput.max = newMax;
                
                if (parseInt(startIndexInput.value) > newMax) {
                    startIndexInput.value = 1;
                }
            });

            durationButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    durationButtons.forEach(b => b.classList.remove('selected'));
                    this.classList.add('selected');
                    intervalDuration = parseInt(this.dataset.duration);
                });
            });
        });

    </script>
</body>
</html>
